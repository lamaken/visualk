<!DOCTYPE html>
<!--
Copyright (C) 2017 lamaken

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
-->
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Mosaic Editor v0.32</title>
        <meta name="Keywords"
              content="mosaic,round, mosaic editor" />
        <meta name="Description"
              content="Design your own mosaics. Let computer draw or paint for you." />
        <meta name="Author" content="lamaken@gmail.com" />
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="img/ico" href="/visualk/favicon.ico">


    </head>
    <body onload="updateMain()">
        <div id="idMosaic" style="position: fixed;padding: 30px;border: 1px activeborder solid;background-color: white;left:30px;top:15px;">
            <center>

                <div id="container" style="background-color: white">

                </div>

                <input onchange="updateMain()"  id="mx" type="range" name="mx" min="50" max="300" value="175"/><div id="lmx"  style="color:blue;font-family: monospace; text-decoration: activecaption solid;font-size:  smaller">a</div>
                <input onchange="updateMain()" id="my" type="range" name="my" min="50" max="300" value="175"/><div id="lmy" style="color:blue;font-family: monospace; text-decoration: activecaption solid ;font-size:  smaller">c</div>
                <input onchange="updateMain()" id="cell" type="range" name="cell" min="1" max="10" value="3"/><div style="color:blue;font-family: monospace; text-decoration: activecaption solid ;font-size:  smaller" id="lcell">m</div> 
                <br/><input value="colorize" type="button" onclick="updateMain();"/>

            </center>
        </div>


        <canvas id="mosaic" ></canvas>

        <script>
            var seed = 0;
            function HSVtoRGB(h, s, v) {

                h = parseInt(h, 10);
                s = parseInt(s, 10);
                v = parseInt(v, 10);
                var r, g, b;
                if (s !== 0) {
                    s /= 100;
                }
                if (v !== 0) {
                    v /= 100;
                }

                if (s === 0) {
                    console.log("s === 0");
                    r = v;
                    g = v;
                    b = v;
                    return "#" + Math.floor(r * 0xff).toString(16) +
                            Math.floor(g * 0xff).toString(16) +
                            Math.floor(b * 0xff).toString(16);
                }

                var i, f, m, n, k;
                i = Math.floor(h / 60);
                f = h / 60 - i;
                m = v * (1 - s);
                n = v * (1 - s * f);
                k = v * (1 - s * (1 - f));
                switch (i) {
                    case 0:
                        r = v;
                        g = k;
                        b = m;
                        break;
                    case 1:
                        r = n;
                        g = v;
                        b = m;
                        break;
                    case 2:
                        r = m;
                        g = v;
                        b = k;
                        break;
                    case 3:
                        r = m;
                        g = n;
                        b = v;
                        break;
                    case 4:
                        r = k;
                        g = m;
                        b = v;
                        break;
                    case 5:
                        r = v;
                        g = m;
                        b = n;
                        break;
                    default:
                        break;
                }


                r = Math.floor(r * 0xff).toString(16);
                g = Math.floor(g * 0xff).toString(16);
                b = Math.floor(b * 0xff).toString(16);
                r = r.length == 1 ? r = '0' + r : r;
                g = g.length == 1 ? g = '0' + g : g;
                b = b.length == 1 ? b = '0' + b : b;
                return getColor(r, g, b);
            }
            function ellipse(context, cx, cy, rx, ry) {
                context.save(); // save state
                context.beginPath();

                context.translate(cx - rx, cy - ry);
                context.scale(rx, ry);
                context.arc(1, 1, 1, 0, 2 * Math.PI, false);

                context.restore(); // restore to original state
                context.stroke();
            }
            function getRndColor() {
                var r = Math.round(Math.random() * 256);
                var g = Math.round(Math.random() * 256);
                var b = Math.round(Math.random() * 256);


                return getColor(r, g, b);
            }


            function updateMain() {
                var mx = document.getElementById("mx").value;
                var my = document.getElementById("my").value;
                var cell = document.getElementById("cell").value;
                var lmx = document.getElementById("lmx");
                var lmy = document.getElementById("lmy");
                var lcell = document.getElementById("lcell");
                lmx.innerHTML = mx;
                lmy.innerHTML = my;
                lcell.innerHTML = cell;
                // document.getElementById('mostra').width = mx;
                // document.getElementById('mostra').height = my;

                if (document.getElementById("mostra") != null) {
                    document.getElementById("container").removeChild(document.getElementById("mostra"));
                }
                var mostra = document.createElement('canvas');
                mostra.id = "mostra";
                mostra.setAttribute("width", mx);
                mostra.setAttribute("height", my);
                document.getElementById("container").appendChild(mostra);
                var mosaic = document.getElementById('mosaic');
                mosaic.width = window.outerWidth;
                mosaic.height = window.outerHeight;
                var ctxmostra = mostra.getContext('2d');
                var ctxmosaic = mosaic.getContext('2d');
                var radiusX = Math.round((mx / 2 / cell));
                var radiusY = Math.round(my / 2 / cell);
//                ctxmostra.imageSmoothingEnabled = false;
//               ctxmosaic.imageSmoothingEnabled = false;

                var mod = 0;
                seed += 0.001;
                if (seed > 0.3)
                    seed = 0;
                ctxmostra.fillStyle = "black";
                ctxmostra.fillRect(0, 0, mostra.width, mostra.height);

                for (var x = 0; x < Math.round(cell * radiusX); x += radiusX) {

                    for (var y = 0; y < Math.round(cell * radiusY); y += radiusY) {
                        var color = getRndColor();

                        ctxmostra.fillStyle = color;
                        ctxmostra.fillRect(x, y, radiusX, radiusY);
                        
                //        ellipse(ctxmostra,x+radiusX,y+radiusY,radiusX,radiusY);
                        
                        ctxmostra.fillRect(mostra.width - x - radiusX, y, radiusX, radiusY);
                        ctxmostra.fillRect(x, mostra.height - y - radiusY, radiusX, radiusY);
                        ctxmostra.fillRect(mostra.width - x - radiusX, mostra.height - y - radiusY, radiusX, radiusY);
                
                    }
                }





                /*
                 * 
                 * 
                 */
                var raxola = ctxmostra.getImageData(0, 0, mostra.width, mostra.height);
                //ctxmostra.fillStyle = "white";
                //ctxmostra.rect(0, 0, mostra.width, mostra.height);
                //ctxmostra.rect(0, 0, mostra.width/2, mostra.height/2);

                //ctxmostra.stroke();
                //muntem el mosaic
                for (var mmx = 0; mmx < mosaic.width; mmx += mostra.width) {//mostra.width){
                    for (var mmy = 0; mmy < mosaic.height; mmy += mostra.height) {
                        ctxmosaic.putImageData(raxola, mmx, mmy);
                    }

                }
            }

            function getColor(r, g, b) {
                return "rgb(" + r + "," + g + "," + b + ")";
            }



            //ctxmosaic.putImageData(raxola, mx, my);







            /*
             var imgd = context.getImageData(0, 0, canvas.width / 2, canvas.height / 2);
             var pix = imgd.data;
             
             y = 0;
             i = 0;
             for (var x = 0; x < canvas.width / 2; x++) {
             for (var y = 0; y < canvas.height / 2; y++) {
             pix[i  ] = pix[i  ]; // red
             pix[i + 1] = pix[i + 1]; // green
             pix[i + 2] = pix[i + 2]; // blue
             i++;
             }
             }
             
             context.putImageData(imgd, 0, 100);
             context.putImageData(imgd, 0, 0);
             context.putImageData(imgd, 100, 0);
             context.putImageData(imgd, 100, 100);
             */

        </script>
    </body>
</html>
